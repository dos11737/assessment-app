<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="ä»‹è­·ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ">
    <meta name="theme-color" content="#667eea">
    
    <title>ä»‹è­·ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆæ”¯æ´ãƒ„ãƒ¼ãƒ«</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Apple Touch Icons -->
    <link rel="apple-touch-icon" href="icon-192.png">
    <link rel="apple-touch-icon" sizes="180x180" href="icon-192.png">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Meiryo, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: env(safe-area-inset-top) env(safe-area-inset-right) env(safe-area-inset-bottom) env(safe-area-inset-left);
            padding-top: max(20px, env(safe-area-inset-top));
            padding-bottom: max(20px, env(safe-area-inset-bottom));
        }
        
        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px 20px;
            text-align: center;
        }
        
        h1 {
            font-size: 24px;
            margin-bottom: 10px;
        }
        
        .subtitle {
            opacity: 0.9;
            font-size: 13px;
        }
        
        .main-content {
            padding: 20px;
        }
        
        .section {
            margin-bottom: 25px;
        }
        
        .section-title {
            font-size: 18px;
            color: #667eea;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #667eea;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 14px 20px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            touch-action: manipulation;
            -webkit-user-select: none;
            user-select: none;
        }
        
        button:active {
            transform: scale(0.95);
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn-danger {
            background: #ff4757;
            color: white;
        }
        
        .btn-success {
            background: #2ecc71;
            color: white;
        }
        
        .recording-indicator {
            display: none;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background: #ffe6e6;
            border-radius: 12px;
            margin-top: 15px;
        }
        
        .recording-indicator.active {
            display: flex;
        }
        
        .pulse {
            width: 12px;
            height: 12px;
            background: #ff4757;
            border-radius: 50%;
            animation: pulse 1.5s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }
        
        .file-upload {
            margin-top: 15px;
        }
        
        .file-upload input[type="file"] {
            display: none;
        }
        
        .file-upload label {
            display: inline-block;
            padding: 14px 20px;
            background: #f0f0f0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
            touch-action: manipulation;
        }
        
        .file-upload label:active {
            transform: scale(0.95);
        }
        
        .transcript-box {
            width: 100%;
            background: #f9f9f9;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            padding: 15px;
            min-height: 120px;
            max-height: 250px;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            margin-top: 15px;
            line-height: 1.6;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            transition: border-color 0.3s;
            -webkit-appearance: none;
        }
        
        .transcript-box:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .transcript-box.empty::placeholder {
            color: #999;
            font-style: italic;
        }
        
        .api-key-section {
            background: #fff9e6;
            border: 2px solid #ffd700;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
        }
        
        .api-key-section h3 {
            font-size: 16px;
            margin-bottom: 10px;
        }
        
        .api-key-section p {
            margin: 10px 0;
            font-size: 13px;
            color: #666;
            line-height: 1.5;
        }
        
        .api-key-input {
            display: flex;
            gap: 10px;
            margin-top: 10px;
        }
        
        .api-key-input input {
            flex: 1;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 12px;
            font-size: 14px;
        }
        
        .api-status {
            margin-top: 10px;
            padding: 10px;
            border-radius: 12px;
            font-size: 13px;
        }
        
        .api-status.not-set {
            background: #ffe6e6;
            color: #c0392b;
        }
        
        .api-status.set {
            background: #e6ffe6;
            color: #27ae60;
        }
        
        .assessment-form {
            margin-top: 20px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
            display: block;
            font-size: 14px;
        }
        
        .form-label .item-number {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 6px;
            font-size: 12px;
            margin-right: 8px;
        }
        
        textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
            min-height: 80px;
            transition: border-color 0.3s;
            -webkit-appearance: none;
        }
        
        textarea:focus {
            outline: none;
            border-color: #667eea;
        }
        
        .category-header {
            background: #f0f0f0;
            padding: 15px;
            border-radius: 12px;
            margin: 25px 0 15px 0;
            font-size: 16px;
            font-weight: 600;
            color: #667eea;
        }
        
        .copy-all-btn {
            position: sticky;
            top: 10px;
            z-index: 100;
            margin-bottom: 20px;
            width: 100%;
        }
        
        .success-message {
            display: none;
            background: #2ecc71;
            color: white;
            padding: 15px;
            border-radius: 12px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
        }
        
        .success-message.show {
            display: block;
            animation: fadeIn 0.3s;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }
        
        .loading.active {
            display: block;
        }
        
        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .install-prompt {
            background: #e8f4f8;
            border: 2px solid #3498db;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            display: none;
        }
        
        .install-prompt.show {
            display: block;
        }
        
        .install-prompt h3 {
            font-size: 16px;
            color: #2980b9;
            margin-bottom: 10px;
        }
        
        .install-prompt p {
            font-size: 13px;
            color: #555;
            line-height: 1.5;
            margin-bottom: 10px;
        }
        
        .install-prompt button {
            width: 100%;
        }
        
        /* iOS Safariå°‚ç”¨ã‚¹ã‚¿ã‚¤ãƒ« */
        @supports (-webkit-touch-callout: none) {
            body {
                padding-bottom: max(40px, env(safe-area-inset-bottom));
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>ğŸ¥ ä»‹è­·ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆæ”¯æ´ãƒ„ãƒ¼ãƒ«</h1>
            <p class="subtitle">éŸ³å£°ã‹ã‚‰ä»‹è­·æ”¯æ´å°‚é–€å“¡ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆæ¨™æº–é …ç›®23é …ç›®ã‚’æŠ½å‡º</p>
        </header>
        
        <div class="main-content">
            <!-- ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¡ˆå†… -->
            <div class="install-prompt" id="installPrompt">
                <h3>ğŸ“± ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ </h3>
                <p>ã“ã®ã‚¢ãƒ—ãƒªã‚’ãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã™ã‚‹ã¨ã€ã‚¢ãƒ—ãƒªã®ã‚ˆã†ã«ä½¿ç”¨ã§ãã¾ã™ã€‚</p>
                <p><strong>æ‰‹é †:</strong><br>
                1. ä¸‹éƒ¨ã®å…±æœ‰ãƒœã‚¿ãƒ³(â–¡â†‘)ã‚’ã‚¿ãƒƒãƒ—<br>
                2. ã€Œãƒ›ãƒ¼ãƒ ç”»é¢ã«è¿½åŠ ã€ã‚’é¸æŠ<br>
                3. ã€Œè¿½åŠ ã€ã‚’ã‚¿ãƒƒãƒ—</p>
                <button class="btn-primary" onclick="closeInstallPrompt()">é–‰ã˜ã‚‹</button>
            </div>
            
            <!-- Claude APIè¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="api-key-section">
                <h3>ğŸ”‘ Claude APIè¨­å®š(ã‚ªãƒ—ã‚·ãƒ§ãƒ³)</h3>
                <p>ã‚ˆã‚Šé«˜ç²¾åº¦ãªæŠ½å‡ºã‚’è¡Œã†å ´åˆã¯Claude APIã‚­ãƒ¼ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚æœªè¨­å®šã®å ´åˆã¯ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã§æŠ½å‡ºã—ã¾ã™ã€‚</p>
                <div class="api-key-input">
                    <input type="password" id="apiKey" placeholder="sk-ant-api03-...">
                    <button class="btn-primary" onclick="saveApiKey()">ä¿å­˜</button>
                </div>
                <div id="apiStatus" class="api-status not-set">
                    âŒ APIã‚­ãƒ¼æœªè¨­å®š(ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹æŠ½å‡ºãƒ¢ãƒ¼ãƒ‰)
                </div>
            </div>
            
            <!-- éŸ³å£°å…¥åŠ›ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="section">
                <h2 class="section-title">ğŸ¤ éŸ³å£°å…¥åŠ›</h2>
                <div class="button-group">
                    <button class="btn-primary" onclick="startRecording()">
                        ğŸ”´ éŒ²éŸ³é–‹å§‹
                    </button>
                    <button class="btn-danger" onclick="stopRecording()" disabled id="stopBtn">
                        â¹ï¸ éŒ²éŸ³åœæ­¢
                    </button>
                    <button class="btn-secondary" onclick="clearTranscript()">
                        ğŸ—‘ï¸ ã‚¯ãƒªã‚¢
                    </button>
                </div>
                
                <div class="recording-indicator" id="recordingIndicator">
                    <div class="pulse"></div>
                    <span>éŒ²éŸ³ä¸­...</span>
                </div>
                
                <div class="file-upload">
                    <label for="audioFile">ğŸ“ éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰</label>
                    <input type="file" id="audioFile" accept="audio/*" onchange="handleFileUpload(event)">
                    <div id="fileName" style="margin-top: 10px; color: #666; font-size: 13px;"></div>
                </div>
                
                <textarea id="transcript" class="transcript-box empty" placeholder="æ–‡å­—èµ·ã“ã—ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã¾ã™...&#10;&#10;æ‰‹å‹•ã§ç·¨é›†ãƒ»å…¥åŠ›ã‚‚å¯èƒ½ã§ã™"></textarea>
            </div>
            
            <!-- æŠ½å‡ºãƒœã‚¿ãƒ³ -->
            <div class="section">
                <button class="btn-success" onclick="extractAssessment()" style="width: 100%; padding: 15px; font-size: 16px;">
                    âœ¨ ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé …ç›®ã‚’æŠ½å‡º
                </button>
                
                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p style="margin-top: 10px; font-size: 14px;">æŠ½å‡ºä¸­...</p>
                </div>
            </div>
            
            <!-- æˆåŠŸãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ -->
            <div id="successMessage" class="success-message">
                âœ… ã‚³ãƒ”ãƒ¼ã—ã¾ã—ãŸ!
            </div>
            
            <!-- ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆãƒ•ã‚©ãƒ¼ãƒ  -->
            <div class="section">
                <h2 class="section-title">ğŸ“‹ ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆé …ç›®</h2>
                
                <button class="btn-primary copy-all-btn" onclick="copyAllItems()">
                    ğŸ“„ å…¨é …ç›®ã‚’ã‚³ãƒ”ãƒ¼
                </button>
                
                <div class="assessment-form" id="assessmentForm">
                    <div class="category-header">åŸºæœ¬æƒ…å ±ã«é–¢ã™ã‚‹é …ç›®</div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">1</span>åŸºæœ¬æƒ…å ±
                        </label>
                        <textarea id="item1" placeholder="æ°åã€æ€§åˆ¥ã€ç”Ÿå¹´æœˆæ—¥ã€ä½æ‰€ã€é›»è©±ç•ªå·ç­‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">2</span>ç”Ÿæ´»çŠ¶æ³
                        </label>
                        <textarea id="item2" placeholder="ç¾åœ¨ã®ç”Ÿæ´»çŠ¶æ³ã€ç”Ÿæ´»æ­´ç­‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">3</span>åˆ©ç”¨è€…ã®è¢«ä¿é™ºè€…æƒ…å ±
                        </label>
                        <textarea id="item3" placeholder="ä»‹è­·ä¿é™ºã€åŒ»ç™‚ä¿é™ºã€ç”Ÿæ´»ä¿è­·ã€èº«ä½“éšœå®³è€…æ‰‹å¸³ã®æœ‰ç„¡ç­‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">4</span>ç¾åœ¨åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ³
                        </label>
                        <textarea id="item4" placeholder="ä»‹è­·ä¿é™ºçµ¦ä»˜ã®å†…å¤–ã‚’å•ã‚ãšã€ç¾åœ¨å—ã‘ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">5</span>éšœå®³é«˜é½¢è€…ã®æ—¥å¸¸ç”Ÿæ´»è‡ªç«‹åº¦
                        </label>
                        <textarea id="item5" placeholder="ãƒ©ãƒ³ã‚¯Jã€œCã®æ—¥å¸¸ç”Ÿæ´»è‡ªç«‹åº¦(å¯ãŸãã‚Šåº¦)"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">6</span>èªçŸ¥ç—‡é«˜é½¢è€…ã®æ—¥å¸¸ç”Ÿæ´»è‡ªç«‹åº¦
                        </label>
                        <textarea id="item6" placeholder="è‡ªç«‹ãƒ©ãƒ³ã‚¯â… ã€œMã®èªçŸ¥ç—‡ã®æ–¹ã®æ—¥å¸¸ç”Ÿæ´»è‡ªç«‹åº¦"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">7</span>ä¸»è¨´
                        </label>
                        <textarea id="item7" placeholder="åˆ©ç”¨è€…ã‚„ã”å®¶æ—ã®ä¸»ãªå¸Œæœ›ã€è¦æœ›"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">8</span>èªå®šæƒ…å ±
                        </label>
                        <textarea id="item8" placeholder="è¦ä»‹è­·åº¦åŒºåˆ†ãªã©èªå®šçµæœã®æƒ…å ±"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">9</span>èª²é¡Œåˆ†æ(ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ)ç†ç”±
                        </label>
                        <textarea id="item9" placeholder="ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆã‚’å®Ÿæ–½ã™ã‚‹ç†ç”±"></textarea>
                    </div>
                    
                    <div class="category-header">èª²é¡Œåˆ†æ(ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ)ã«é–¢ã™ã‚‹é …ç›®</div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">10</span>å¥åº·çŠ¶æ…‹
                        </label>
                        <textarea id="item10" placeholder="åˆ©ç”¨è€…ã®å¥åº·çŠ¶æ…‹ã€æ—¢å¾€æ­´ã€æœè–¬çŠ¶æ³ç­‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">11</span>ADL(æ—¥å¸¸ç”Ÿæ´»å‹•ä½œ)
                        </label>
                        <textarea id="item11" placeholder="ç§»å‹•ã€é£Ÿäº‹ã€æ’æ³„ã€å…¥æµ´ã€æ›´è¡£ç­‰ã®çŠ¶æ³"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">12</span>IADL(æ‰‹æ®µçš„æ—¥å¸¸ç”Ÿæ´»å‹•ä½œ)
                        </label>
                        <textarea id="item12" placeholder="èª¿ç†ã€æƒé™¤ã€æ´—æ¿¯ã€è²·ã„ç‰©ã€é‡‘éŠ­ç®¡ç†ç­‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">13</span>èªçŸ¥
                        </label>
                        <textarea id="item13" placeholder="èªçŸ¥èƒ½åŠ›ã®ç¨‹åº¦ã€è¨˜æ†¶åŠ›ã€åˆ¤æ–­åŠ›ç­‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">14</span>ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³èƒ½åŠ›
                        </label>
                        <textarea id="item14" placeholder="æ„æ€ç–é€šã®çŠ¶æ³ã€ä¼šè©±èƒ½åŠ›ç­‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">15</span>ç¤¾ä¼šã¨ã®é–¢ã‚ã‚Š
                        </label>
                        <textarea id="item15" placeholder="ç¤¾ä¼šå‚åŠ ã®çŠ¶æ³ã€åœ°åŸŸã¨ã®é–¢ä¿‚ç­‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">16</span>æ’å°¿ãƒ»æ’ä¾¿
                        </label>
                        <textarea id="item16" placeholder="æ’æ³„ã®é »åº¦ã€ãƒãƒ¼ã‚¿ãƒ–ãƒ«ãƒˆã‚¤ãƒ¬ã€ãŠã‚€ã¤ç­‰ã®ä½¿ç”¨çŠ¶æ³"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">17</span>è¤¥ç˜¡ãƒ»çš®è†šã®å•é¡Œ
                        </label>
                        <textarea id="item17" placeholder="è¤¥ç˜¡ã€çš®è†šã®æ¸…æ½”çŠ¶æ³ç­‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">18</span>å£è…”è¡›ç”Ÿ
                        </label>
                        <textarea id="item18" placeholder="æ­¯ã‚„å£è…”å†…ã®çŠ¶æ…‹ã€è¡›ç”ŸçŠ¶æ³ç­‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">19</span>é£Ÿäº‹æ‘‚å–
                        </label>
                        <textarea id="item19" placeholder="æ „é¤Šã€é£Ÿäº‹å›æ•°ã€æ°´åˆ†é‡ç­‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">20</span>å•é¡Œè¡Œå‹•
                        </label>
                        <textarea id="item20" placeholder="æš´è¨€æš´è¡Œã€å¾˜å¾Šç­‰ã®è¡Œå‹•"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">21</span>ä»‹è­·åŠ›
                        </label>
                        <textarea id="item21" placeholder="ä»‹è­·è€…ã®æœ‰ç„¡ã€ä»‹è­·æ„æ€ã€ä»‹è­·è² æ‹…ç­‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">22</span>å±…ä½ç’°å¢ƒ
                        </label>
                        <textarea id="item22" placeholder="å±…ä½ç’°å¢ƒã€ä½å®…æ”¹ä¿®ã®å¿…è¦æ€§ç­‰"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">
                            <span class="item-number">23</span>ç‰¹åˆ¥ãªçŠ¶æ³
                        </label>
                        <textarea id="item23" placeholder="è™å¾…ã€çµ‚æœ«æœŸã‚±ã‚¢(ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚±ã‚¢)ç­‰"></textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let recognition;
        let isRecording = false;
        let transcript = '';
        let apiKey = localStorage.getItem('claudeApiKey') || '';

        // Service Workerã®ç™»éŒ²
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('service-worker.js')
                    .then(registration => console.log('SW registered'))
                    .catch(err => console.log('SW registration failed'));
            });
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã®å‡¦ç†
        window.onload = function() {
            if (apiKey) {
                document.getElementById('apiKey').value = apiKey;
                updateApiStatus(true);
            }
            
            // Web Speech APIã®å¯¾å¿œç¢ºèª
            if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
                alert('ãŠä½¿ã„ã®ãƒ–ãƒ©ã‚¦ã‚¶ã¯éŸ³å£°èªè­˜ã«å¯¾å¿œã—ã¦ã„ã¾ã›ã‚“ã€‚Safariã‚’ã”åˆ©ç”¨ãã ã•ã„ã€‚');
            }
            
            // iOS Safariã§ã‚¹ã‚¿ãƒ³ãƒ‰ã‚¢ãƒ­ãƒ³ãƒ¢ãƒ¼ãƒ‰ã§ãªã„å ´åˆã€ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¡ˆå†…ã‚’è¡¨ç¤º
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent);
            const isStandalone = window.navigator.standalone || window.matchMedia('(display-mode: standalone)').matches;
            
            if (isIOS && !isStandalone) {
                setTimeout(() => {
                    document.getElementById('installPrompt').classList.add('show');
                }, 2000);
            }
        };

        function closeInstallPrompt() {
            document.getElementById('installPrompt').classList.remove('show');
        }

        // APIã‚­ãƒ¼ã®ä¿å­˜
        function saveApiKey() {
            const key = document.getElementById('apiKey').value.trim();
            if (key) {
                localStorage.setItem('claudeApiKey', key);
                apiKey = key;
                updateApiStatus(true);
                alert('APIã‚­ãƒ¼ã‚’ä¿å­˜ã—ã¾ã—ãŸ');
            } else {
                localStorage.removeItem('claudeApiKey');
                apiKey = '';
                updateApiStatus(false);
                alert('APIã‚­ãƒ¼ã‚’å‰Šé™¤ã—ã¾ã—ãŸ');
            }
        }

        // APIã‚­ãƒ¼çŠ¶æ…‹ã®æ›´æ–°
        function updateApiStatus(isSet) {
            const statusEl = document.getElementById('apiStatus');
            if (isSet) {
                statusEl.className = 'api-status set';
                statusEl.textContent = 'âœ… APIã‚­ãƒ¼è¨­å®šæ¸ˆã¿(Claude APIæŠ½å‡ºãƒ¢ãƒ¼ãƒ‰)';
            } else {
                statusEl.className = 'api-status not-set';
                statusEl.textContent = 'âŒ APIã‚­ãƒ¼æœªè¨­å®š(ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹æŠ½å‡ºãƒ¢ãƒ¼ãƒ‰)';
            }
        }

        // éŒ²éŸ³é–‹å§‹
        function startRecording() {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            recognition = new SpeechRecognition();
            recognition.lang = 'ja-JP';
            recognition.continuous = true;
            recognition.interimResults = true;

            recognition.onstart = function() {
                isRecording = true;
                document.getElementById('recordingIndicator').classList.add('active');
                document.getElementById('stopBtn').disabled = false;
                document.querySelector('button[onclick="startRecording()"]').disabled = true;
            };

            recognition.onresult = function(event) {
                let interimTranscript = '';
                let finalTranscript = '';

                for (let i = event.resultIndex; i < event.results.length; i++) {
                    const transcriptPiece = event.results[i][0].transcript;
                    if (event.results[i].isFinal) {
                        finalTranscript += transcriptPiece;
                    } else {
                        interimTranscript += transcriptPiece;
                    }
                }

                transcript += finalTranscript;
                const transcriptEl = document.getElementById('transcript');
                transcriptEl.value = transcript + interimTranscript;
                transcriptEl.classList.remove('empty');
            };

            recognition.onerror = function(event) {
                console.error('éŸ³å£°èªè­˜ã‚¨ãƒ©ãƒ¼:', event.error);
                stopRecording();
            };

            recognition.start();
        }

        // éŒ²éŸ³åœæ­¢
        function stopRecording() {
            if (recognition) {
                recognition.stop();
                isRecording = false;
                document.getElementById('recordingIndicator').classList.remove('active');
                document.getElementById('stopBtn').disabled = true;
                document.querySelector('button[onclick="startRecording()"]').disabled = false;
            }
        }

        // æ–‡å­—èµ·ã“ã—ã‚¯ãƒªã‚¢
        function clearTranscript() {
            if (confirm('æ–‡å­—èµ·ã“ã—ãƒ†ã‚­ã‚¹ãƒˆã‚’ã‚¯ãƒªã‚¢ã—ã¾ã™ã‹?')) {
                transcript = '';
                const transcriptEl = document.getElementById('transcript');
                transcriptEl.value = '';
                transcriptEl.classList.add('empty');
                document.getElementById('fileName').textContent = '';
            }
        }

        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰å‡¦ç†
        function handleFileUpload(event) {
            const file = event.target.files[0];
            if (file) {
                document.getElementById('fileName').textContent = 'é¸æŠ: ' + file.name;
                
                // éŸ³å£°ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å†ç”Ÿã—ã¦Web Speech APIã§èªè­˜
                const audio = new Audio(URL.createObjectURL(file));
                const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                const recognition = new SpeechRecognition();
                recognition.lang = 'ja-JP';
                recognition.continuous = true;

                audio.onplay = function() {
                    recognition.start();
                };

                recognition.onresult = function(event) {
                    let finalTranscript = '';
                    for (let i = event.resultIndex; i < event.results.length; i++) {
                        if (event.results[i].isFinal) {
                            finalTranscript += event.results[i][0].transcript;
                        }
                    }
                    transcript += finalTranscript;
                    const transcriptEl = document.getElementById('transcript');
                    transcriptEl.value = transcript;
                    transcriptEl.classList.remove('empty');
                };

                audio.onended = function() {
                    recognition.stop();
                };

                audio.play();
            }
        }

        // ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆæŠ½å‡º
        async function extractAssessment() {
            const transcriptEl = document.getElementById('transcript');
            const transcriptText = transcriptEl.value.trim();
            
            if (!transcriptText || transcriptText === '') {
                alert('æ–‡å­—èµ·ã“ã—ãƒ†ã‚­ã‚¹ãƒˆãŒã‚ã‚Šã¾ã›ã‚“');
                return;
            }

            document.getElementById('loading').classList.add('active');

            if (apiKey) {
                await extractWithClaudeAPI(transcriptText);
            } else {
                extractWithKeywords(transcriptText);
            }

            document.getElementById('loading').classList.remove('active');
        }

        // Claude APIã‚’ä½¿ç”¨ã—ãŸæŠ½å‡º
        async function extractWithClaudeAPI(text) {
            try {
                const response = await fetch('https://api.anthropic.com/v1/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'x-api-key': apiKey,
                        'anthropic-version': '2023-06-01'
                    },
                    body: JSON.stringify({
                        model: 'claude-sonnet-4-20250514',
                        max_tokens: 4000,
                        messages: [{
                            role: 'user',
                            content: `ä»¥ä¸‹ã®æ–‡å­—èµ·ã“ã—ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰ã€ä»‹è­·æ”¯æ´å°‚é–€å“¡ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆæ¨™æº–é …ç›®23é …ç›®ã‚’æŠ½å‡ºã—ã¦ãã ã•ã„ã€‚
å„é …ç›®ã«ã¤ã„ã¦ã€ãƒ†ã‚­ã‚¹ãƒˆã‹ã‚‰é–¢é€£ã™ã‚‹æƒ…å ±ã‚’æŠ½å‡ºã—ã€è©²å½“ã™ã‚‹æƒ…å ±ãŒãªã„å ´åˆã¯ã€Œæƒ…å ±ãªã—ã€ã¨è¨˜è¼‰ã—ã¦ãã ã•ã„ã€‚

æ–‡å­—èµ·ã“ã—ãƒ†ã‚­ã‚¹ãƒˆ:
${text}

ä»¥ä¸‹ã®å½¢å¼ã§å‡ºåŠ›ã—ã¦ãã ã•ã„:
1. åŸºæœ¬æƒ…å ±: [æŠ½å‡ºå†…å®¹]
2. ç”Ÿæ´»çŠ¶æ³: [æŠ½å‡ºå†…å®¹]
3. åˆ©ç”¨è€…ã®è¢«ä¿é™ºè€…æƒ…å ±: [æŠ½å‡ºå†…å®¹]
4. ç¾åœ¨åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ³: [æŠ½å‡ºå†…å®¹]
5. éšœå®³é«˜é½¢è€…ã®æ—¥å¸¸ç”Ÿæ´»è‡ªç«‹åº¦: [æŠ½å‡ºå†…å®¹]
6. èªçŸ¥ç—‡é«˜é½¢è€…ã®æ—¥å¸¸ç”Ÿæ´»è‡ªç«‹åº¦: [æŠ½å‡ºå†…å®¹]
7. ä¸»è¨´: [æŠ½å‡ºå†…å®¹]
8. èªå®šæƒ…å ±: [æŠ½å‡ºå†…å®¹]
9. èª²é¡Œåˆ†æ(ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ)ç†ç”±: [æŠ½å‡ºå†…å®¹]
10. å¥åº·çŠ¶æ…‹: [æŠ½å‡ºå†…å®¹]
11. ADL(æ—¥å¸¸ç”Ÿæ´»å‹•ä½œ): [æŠ½å‡ºå†…å®¹]
12. IADL(æ‰‹æ®µçš„æ—¥å¸¸ç”Ÿæ´»å‹•ä½œ): [æŠ½å‡ºå†…å®¹]
13. èªçŸ¥: [æŠ½å‡ºå†…å®¹]
14. ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³èƒ½åŠ›: [æŠ½å‡ºå†…å®¹]
15. ç¤¾ä¼šã¨ã®é–¢ã‚ã‚Š: [æŠ½å‡ºå†…å®¹]
16. æ’å°¿ãƒ»æ’ä¾¿: [æŠ½å‡ºå†…å®¹]
17. è¤¥ç˜¡ãƒ»çš®è†šã®å•é¡Œ: [æŠ½å‡ºå†…å®¹]
18. å£è…”è¡›ç”Ÿ: [æŠ½å‡ºå†…å®¹]
19. é£Ÿäº‹æ‘‚å–: [æŠ½å‡ºå†…å®¹]
20. å•é¡Œè¡Œå‹•: [æŠ½å‡ºå†…å®¹]
21. ä»‹è­·åŠ›: [æŠ½å‡ºå†…å®¹]
22. å±…ä½ç’°å¢ƒ: [æŠ½å‡ºå†…å®¹]
23. ç‰¹åˆ¥ãªçŠ¶æ³: [æŠ½å‡ºå†…å®¹]`
                        }]
                    })
                });

                const data = await response.json();
                
                if (data.content && data.content[0]) {
                    parseAndFillForm(data.content[0].text);
                } else {
                    alert('APIã‹ã‚‰ã®å¿œç­”ãŒä¸æ­£ã§ã™');
                    console.error(data);
                }
            } catch (error) {
                alert('APIå‘¼ã³å‡ºã—ã‚¨ãƒ©ãƒ¼: ' + error.message);
                console.error(error);
            }
        }

        // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®æŠ½å‡º
        function extractWithKeywords(text) {
            const keywords = {
                1: ['åå‰', 'æ°å', 'ç”Ÿå¹´æœˆæ—¥', 'ä½æ‰€', 'é›»è©±', 'å¹´é½¢'],
                2: ['ç”Ÿæ´»', 'æš®ã‚‰ã—', 'æ—¥å¸¸', 'å®¶æ—æ§‹æˆ', 'ç‹¬å±…', 'åŒå±…'],
                3: ['ä¿é™º', 'è¢«ä¿é™ºè€…', 'è¦ä»‹è­·', 'è¦æ”¯æ´', 'éšœå®³è€…æ‰‹å¸³'],
                4: ['ã‚µãƒ¼ãƒ“ã‚¹', 'åˆ©ç”¨ä¸­', 'ãƒ‡ã‚¤ã‚µãƒ¼ãƒ“ã‚¹', 'è¨ªå•ä»‹è­·', 'ãƒ˜ãƒ«ãƒ‘ãƒ¼'],
                5: ['è‡ªç«‹åº¦', 'å¯ãŸãã‚Š', 'ãƒ©ãƒ³ã‚¯', 'æ­©è¡Œ'],
                6: ['èªçŸ¥ç—‡', 'ç‰©å¿˜ã‚Œ', 'è¦‹å½“è­˜'],
                7: ['å¸Œæœ›', 'è¦æœ›', 'å›°ã£ã¦ã„ã‚‹', 'ï½ã—ãŸã„'],
                8: ['è¦ä»‹è­·', 'èªå®š', 'åŒºåˆ†', 'æ›´æ–°'],
                9: ['ç†ç”±', 'ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ', 'è©•ä¾¡'],
                10: ['å¥åº·', 'ç—…æ°—', 'æ—¢å¾€æ­´', 'æœè–¬', 'è–¬', 'é€šé™¢'],
                11: ['ç§»å‹•', 'é£Ÿäº‹', 'æ’æ³„', 'å…¥æµ´', 'æ›´è¡£', 'ç€æ›¿ãˆ', 'æ­©è¡Œ', 'ç«‹ã¤', 'åº§ã‚‹'],
                12: ['èª¿ç†', 'æƒé™¤', 'æ´—æ¿¯', 'è²·ã„ç‰©', 'é‡‘éŠ­ç®¡ç†', 'å¤–å‡º'],
                13: ['èªçŸ¥', 'è¨˜æ†¶', 'åˆ¤æ–­', 'ç†è§£'],
                14: ['ä¼šè©±', 'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³', 'è©±ã™', 'èã'],
                15: ['ç¤¾ä¼š', 'åœ°åŸŸ', 'äº¤æµ', 'å¤–å‡º', 'è¶£å‘³'],
                16: ['æ’å°¿', 'æ’ä¾¿', 'ãƒˆã‚¤ãƒ¬', 'ãŠã‚€ã¤', 'å¤±ç¦'],
                17: ['è¤¥ç˜¡', 'åºŠãšã‚Œ', 'çš®è†š', 'ç™ºèµ¤'],
                18: ['å£è…”', 'æ­¯', 'ç¾©æ­¯', 'åš¥ä¸‹'],
                19: ['é£Ÿäº‹', 'æ „é¤Š', 'æ°´åˆ†', 'é£Ÿã¹ã‚‹', 'é£²ã‚€'],
                20: ['æš´è¨€', 'æš´è¡Œ', 'å¾˜å¾Š', 'èˆˆå¥®', 'å•é¡Œè¡Œå‹•'],
                21: ['ä»‹è­·è€…', 'å®¶æ—', 'ä»‹è­·', 'è² æ‹…', 'ã‚µãƒãƒ¼ãƒˆ'],
                22: ['ä½å®…', 'ç’°å¢ƒ', 'æ®µå·®', 'ãƒãƒªã‚¢ãƒ•ãƒªãƒ¼', 'æ”¹ä¿®'],
                23: ['è™å¾…', 'ã‚¿ãƒ¼ãƒŸãƒŠãƒ«', 'çµ‚æœ«æœŸ', 'ç‰¹åˆ¥']
            };

            for (let i = 1; i <= 23; i++) {
                const textarea = document.getElementById('item' + i);
                let extracted = '';
                
                keywords[i].forEach(keyword => {
                    const regex = new RegExp('.{0,30}' + keyword + '.{0,30}', 'g');
                    const matches = text.match(regex);
                    if (matches) {
                        matches.forEach(match => {
                            if (!extracted.includes(match)) {
                                extracted += match + '\n';
                            }
                        });
                    }
                });

                textarea.value = extracted.trim() || '(è©²å½“æƒ…å ±ãªã—)';
            }

            alert('æŠ½å‡ºå®Œäº†(ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹)');
        }

        // Claude APIã®å¿œç­”ã‚’è§£æã—ã¦ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›
        function parseAndFillForm(responseText) {
            const lines = responseText.split('\n');
            let currentItem = 0;

            lines.forEach(line => {
                const match = line.match(/^(\d+)\.\s*(.+?):\s*(.+)$/);
                if (match) {
                    const itemNum = parseInt(match[1]);
                    const content = match[3];
                    
                    if (itemNum >= 1 && itemNum <= 23) {
                        const textarea = document.getElementById('item' + itemNum);
                        if (textarea) {
                            textarea.value = content;
                        }
                    }
                }
            });

            alert('æŠ½å‡ºå®Œäº†(Claude APIä½¿ç”¨)');
        }

        // å…¨é …ç›®ã‚’ã‚³ãƒ”ãƒ¼
        function copyAllItems() {
            let allText = 'ã€ä»‹è­·æ”¯æ´å°‚é–€å“¡ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆæ¨™æº–é …ç›®23é …ç›®ã€‘\n\n';
            allText += '=== åŸºæœ¬æƒ…å ±ã«é–¢ã™ã‚‹é …ç›® ===\n\n';
            
            const labels = [
                'åŸºæœ¬æƒ…å ±',
                'ç”Ÿæ´»çŠ¶æ³',
                'åˆ©ç”¨è€…ã®è¢«ä¿é™ºè€…æƒ…å ±',
                'ç¾åœ¨åˆ©ç”¨ã—ã¦ã„ã‚‹ã‚µãƒ¼ãƒ“ã‚¹ã®çŠ¶æ³',
                'éšœå®³é«˜é½¢è€…ã®æ—¥å¸¸ç”Ÿæ´»è‡ªç«‹åº¦',
                'èªçŸ¥ç—‡é«˜é½¢è€…ã®æ—¥å¸¸ç”Ÿæ´»è‡ªç«‹åº¦',
                'ä¸»è¨´',
                'èªå®šæƒ…å ±',
                'èª²é¡Œåˆ†æ(ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ)ç†ç”±',
                'å¥åº·çŠ¶æ…‹',
                'ADL(æ—¥å¸¸ç”Ÿæ´»å‹•ä½œ)',
                'IADL(æ‰‹æ®µçš„æ—¥å¸¸ç”Ÿæ´»å‹•ä½œ)',
                'èªçŸ¥',
                'ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³èƒ½åŠ›',
                'ç¤¾ä¼šã¨ã®é–¢ã‚ã‚Š',
                'æ’å°¿ãƒ»æ’ä¾¿',
                'è¤¥ç˜¡ãƒ»çš®è†šã®å•é¡Œ',
                'å£è…”è¡›ç”Ÿ',
                'é£Ÿäº‹æ‘‚å–',
                'å•é¡Œè¡Œå‹•',
                'ä»‹è­·åŠ›',
                'å±…ä½ç’°å¢ƒ',
                'ç‰¹åˆ¥ãªçŠ¶æ³'
            ];

            for (let i = 1; i <= 23; i++) {
                if (i === 10) {
                    allText += '\n=== èª²é¡Œåˆ†æ(ã‚¢ã‚»ã‚¹ãƒ¡ãƒ³ãƒˆ)ã«é–¢ã™ã‚‹é …ç›® ===\n\n';
                }
                
                const textarea = document.getElementById('item' + i);
                const value = textarea.value.trim();
                allText += `${i}. ${labels[i-1]}\n`;
                allText += `${value || '(æœªè¨˜å…¥)'}\n\n`;
            }

            navigator.clipboard.writeText(allText).then(() => {
                const msg = document.getElementById('successMessage');
                msg.classList.add('show');
                setTimeout(() => {
                    msg.classList.remove('show');
                }, 2000);
            }).catch(err => {
                alert('ã‚³ãƒ”ãƒ¼ã«å¤±æ•—ã—ã¾ã—ãŸ: ' + err);
            });
        }
    </script>
</body>
</html>
